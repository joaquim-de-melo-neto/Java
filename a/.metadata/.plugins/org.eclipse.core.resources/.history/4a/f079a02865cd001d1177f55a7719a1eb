package books;

import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.sql.Statement;

import javax.swing.JOptionPane;

public class BookDatabase {
    private Connection conn;

// construtor
    public BookDatabase() throws SQLException {
        String url = "jdbc:mysql://localhost:3306/books";
        String user = "root";
        String password = "";
        conn = DriverManager.getConnection(url, user, password);
    }
    
    public void closeConn() throws SQLException {
    	conn.close();
    }
    
// adicionar registro na tabela author
    public void add(String firstName, String lastName) throws SQLException {
        String sql = "INSERT INTO author (firstName, lastName) VALUES (?, ?)";
        PreparedStatement statement = conn.prepareStatement(sql);
        statement.setString(1, firstName);
        statement.setString(2, lastName);
        statement.executeUpdate();
        query();
        statement.close();
        conn.close();
    }
    
// remover registro na tabela author
    public void remove(String primaryKey) throws SQLException {
    	String sql = "DELETE FROM author WHERE id = (?)";
    	PreparedStatement statement = conn.prepareStatement(sql);
    	statement.setString(1, primaryKey);
    	statement.executeUpdate(); // checar se ocorreu
    	query();
    	statement.close();
        conn.close();
    }
    
// atualizar registro
    public void update(String primaryKey, String firstName, String lastName) throws SQLException {
    	
    	String sql = "UPDATE author SET firstName = ?, lastName = ?  WHERE id = ?";
    	PreparedStatement statement = conn.prepareStatement(sql);
    	statement.setString(1, firstName);
    	statement.setString(2, lastName);
    	statement.setString(3, primaryKey);
    	statement.executeUpdate();
    	query();
    	statement.close();
        conn.close();
    }
    
    
// consultar registros da tabela author
    public void query() throws SQLException {
    Statement statement = conn.createStatement();
    ResultSet rs = statement.executeQuery("SELECT * FROM author");
    String finalMessage = new String();
    while (rs.next()) {
        int id = rs.getInt("id");
        String nome = rs.getString("firstName");
        String sobrenome = rs.getString("lastName");
        // Fazer algo com os valores do resultado
        String message = String.format("%3d - %s %s\n",id,nome,sobrenome);
        finalMessage = finalMessage.concat(message);
    }
    
    JOptionPane.showMessageDialog(null,finalMessage);
    rs.close();
    statement.close();
    
    }
}